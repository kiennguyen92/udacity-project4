name: Frontend Continuous Integration

on:
  pull_request:
    branches:    
      - main
  workflow_dispatch:

env: 
  NODE_VERSION: 18
  WORK_DIR: starter/frontend

jobs:
  lint:
    runs-on: ubuntu-latest
    steps: 

      # Checkout code
    - name: Checkout
      uses: actions/checkout@v4
    - name: Change to work directory
      run: cd ${{ env.WORK_DIR }}

      # Setup NodeJS
      # Perform a cache action to restore cache before dependency install
    - name: Setup NodeJS
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION}}
        cache: 'npm'

      # Install dependencies
    - name: Install dependencies
      run: npm ci

      # Lint
    - name: Lint
      run: npm run lint
  
  test:
    runs-on: ubuntu-latest
    steps: 

      # Checkout code
    - name: Checkout
      uses: actions/checkout@v4

    - name: Change to work directory
      run: cd ${{ env.WORK_DIR }}

      # Setup NodeJS
      # Perform a cache action to restore cache before dependency install
    - name: Setup NodeJS
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION}}
        cache: 'npm'

      # Install dependencies
    - name: Install dependencies
      run: npm ci

      # Test
    - name: Lint
      run: npm run test

  build:
    runs-on: ubuntu-latest
    needs:
    - lint
    - test
    steps: 

      # Checkout code
    - name: Checkout
      uses: actions/checkout@v4

    - name: Change to work directory
      run: cd ${{ env.WORK_DIR }}

      # Build
    - name: Build 
      run: docker build -f Dockerfile .